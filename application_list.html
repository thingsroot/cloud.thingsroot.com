<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="/img/favicon.ico" />
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/buttons.dataTables.min.css" rel="stylesheet" />
    <link href="css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="css/select.dataTables.min.css" rel="stylesheet" />
    <link href="css/scroller.dataTables.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/viccom.css" rel="stylesheet" />
    <link href="css/animate.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="js/layui/css/layui.css"  media="all">
    <link rel="stylesheet" href="css/star.css">
    <title>应用列表</title>
</head>
<body style="font-family: '微软雅黑';">

<!-- 顶部导航 start -->
<nav class="nav_herder">
    <div class="nav_left gate_hand" onClick="location='index.html'"><img src="img/cloud_thingslink_logo.png" class="logo"/>冬笋物联网</div>
    <div class="pull-right nav_right">
        <p class="J_getMembers hd"><img src="img/top_management.png"/><span>成员管理</span></p><em>|</em>
        <p onclick="javascript:$('#messageBox').show()" style="position: relative;"><img src="img/top_news.png"/><span class="redDot"></span></p><em>|</em>
        <p onClick="location='personal_info.html'"><img src="img/top_avatar.png"/><span class="J_nickname">昵称</span></p><em>|</em>
        <p><img src="img/top_quit.png" id="J_logout"/></p>
    </div>
</nav>
<!-- 顶部导航 end -->

<div class="down-main">
    <!-- 左侧导航 start -->
    <div class="left-main left-full">
        <div class="sidebar-fold"><img src="img/nav_shrink.png"/></div>
        <div class="subNav" onClick="location='index.html'">
            <img src="img/nav_home.png" class="hd_img"/>
            <img src="img/nav_home_hover.png" class="hover_img"/>
            <p class="sublist-title">首页</p>
        </div>
        <div class="subNav" onClick="location='mine.html'">
            <img src="img/nav_equipment.png" class="hd_img"/>
            <img src="img/nav_equipment_hover.png" class="hover_img"/>
            <p class="sublist-title">我的网关</p>
        </div>
        <div class="subNav bg-color" onClick="location='application_list.html'">
            <img src="img/my_app.png" class="hd_img"/>
            <img src="img/my_apps.png" class="hover_img"/>
            <p class="sublist-title">我的应用</p>
        </div>
        <div class="subNav" onClick="location='template.html'">
            <img src="img/my_app.png" class="hd_img"/>
            <img src="img/my_apps.png" class="hover_img"/>
            <p class="sublist-title">我的模板</p>
        </div>
    </div>
    <!-- 左侧导航 start -->
    <div class="right-product my-index right-full">
        <!-- 标题 -->
        <div class="mes_title">我的应用列表
            <div class="list_search">
                <a class="create_new" href="application_edit.html?appId=1">＋ 创建新应用</a>
                <div class="input-group"  style="width:240px;">
                    <input type="text" class="form-control J_keyword"  placeholder="输入关键词">
                    <span class="input-group-addon search"></span>
                </div>

            </div>
        </div>

        <!--应用列表start-->
        <div class="app_list">
            <ul style="clear: both;">
                <!--<li class="app_list_li">-->
                    <!--<div class="app_image">-->
                        <!--<img src="img/app.jpg" alt="">-->
                    <!--</div>-->
                    <!--<div class="app_info">-->
                        <!--<div>-->
                            <!--<p>Dirk`s openwrt wbox</p>-->
                            <!--<p><span>生产日期：</span><span>2018-09-09</span></p>-->
                            <!--<div>-->
                                <!--<ul class="show_number clearfix">-->
                                    <!--<li>-->
                                        <!--<div class="atar_Show">-->
                                            <!--<p tip="2.5"></p>-->
                                        <!--</div>-->
                                    <!--</li>-->
                                <!--</ul>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div>-->
                            <!--<p><span>应用分类：</span><span>Meter</span></p>-->
                            <!--<p><span>通讯协议：</span><span>MOOT</span></p>-->
                            <!--<p><span>设备厂商：</span><span>冬笋科技</span></p>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<input type="hidden" value="jhawoefihowe">-->
                <!--</li>-->
            </ul>
            <!--无内容状态-->
            <div class="none hd">
                <p><img src="img/photo_wgyy.png"/></p>
                <p>很抱歉，还没有应用，请先创建新应用！</p>
            </div>
            <!--无内容状态end-->

        </div>
        <p class="copyright">SymTech Application © 2008-2017</p>
        <!--应用列表end-->

    </div>

    <!--消息弹框-->
    <div id="messageBox">
        <p id="messageBox_title">最新消息
            <span class="messageBox_close" onClick="javascript:$('#messageBox').hide();">×</span>
        </p>
        <div>
            <p>通信设备</p>
            <ul class="list_box">
                <!--<li class="box_li">-->
                <!--<span class="message_name"></span>-->
                <!--<span style="display: none;" class="message_id"></span>-->
                <!--<span style="float: right;" class="message_ago"></span>-->
                <!--</li>-->
                <!--<li class="box_li">-->
                <!--<span class="message_name"></span>-->
                <!--<span style="display: none;" class="message_id"></span>-->
                <!--<span style="float: right;" class="message_ago"></span>-->
                <!--</li>-->
            </ul>
        </div>
        <p class="GoCenter" onClick="location='platform_message.html'">进入消息中心</p>
    </div>
    <!--消息弹框 end-->
</div>
<!-- 加载script start -->
<script src="js/jquery-1.11.3.min.js" type="text/javascript"></script>
<script src="js/jquery.timeago.js" type="text/javascript"></script>
<script src="js/starScore.js"></script>
<script src="js/transport.js" type="text/javascript"></script>
<script src="js/jQuery.cookie.js" type="text/javascript"></script>
<script src="js/layui/layui.js" charset="utf-8"></script>
<script src="js/bootstrap.min.js" type="text/javascript"></script>
<script src="js/arrayFun.js" type="text/javascript"></script>
<script src="js/common.js" type="text/javascript"></script>
<script src="js/user.js" type="text/javascript"></script>
<script src="js/index.js" type="text/javascript"></script>
<script src="js/message.js"></script>
<script>

    $(function(){

        //获取用户信息
        var usr = getCookie('usr');
        //获取列表
        var userName = {
            'user':usr
        };
        $.ajax({
            url: '/apis/api/method/iot_ui.iot_api.appstore_applist',
            type: 'GET',
            data: userName,
            success:function (req) {
                var data = req.message;
                console.log(data);
                for(var i=0;i<data.length;i++){
                    $('.app_list>ul').append(
                        '<li class="app_list_li">' +
                        '<div class="app_image">' +
                        '<img src="img/app.jpg" alt="">' +
                        '</div>' +
                        '<div class="app_info">' +
                        '<div>' +
                        '<p class="app_name">'+ data[i].app_name +'</p>' +
                        '<p><span>生产日期：</span><span>'+ data[i].creation.substr(0,11) +'</span></p>' +
                        '<div>' +
                        '<ul class="show_number clearfix">' +
                        '<li>' +
                        '<div class="atar_Show">' +
                        '<p tip="'+ data[i].star +'"></p>' +
                        '</div>' +
                        '</li>' +
                        '</ul>' +
                        '</div>' +
                        '</div>' +
                        '<div>' +
                        '<p><span>应用分类：</span><span>'+ data[i].category +'</span></p>' +
                        '<p><span>通讯协议：</span><span>'+ data[i].protocol +'</span></p>' +
                        '<p><span>设备厂商：</span><span>'+ data[i].device_supplier +'</span></p>' +
                        '</div>' +
                        '</div>' +
                        '<input type="hidden" value="'+ data[i].name +'">' +
                        '</li>'
                    )
                }
                //星星显示分数
                $(".show_number li p").each(function(index, element) {
                    var num=$(this).attr("tip");
                    var www=num*16;
                    $(this).css("width",www);
                    $(this).parent(".atar_Show").siblings("span").text(num+"分");
                });
            },
            error:function () {
                console.log('error')
            },
            complete: function () {
                var aLi = $('.app_list>ul>li');
                console.log(aLi.length);
                //判断应用列表是否为空
                if(aLi.length == 0){
                    $('.none').removeClass('hd');
                    $('.app_list').css({'position':'absolute','top':'65px','right':0,'bottom':'30px','left':0});
                    $('.list_search').css('display','none');
                    $('.copyright').addClass('pos');
                }
                //点击名称进入详情
                var name = $('.app_name');
                for(var i=0;i<name.length;i++){
                    name[i].index = i;
                    name[i].onclick = function () {
                        var appId = $(this).parent().parent().parent().find('input').val();
                        location.href = 'application_details.html?appId=' + appId;
                    }
                }
                //点击图片进入详情
                var app_img = $('.app_image');
                for(var j=0;j<app_img.length;j++){
                    app_img[j].index = j;
                    app_img[j].onclick = function () {
                        var appId1 = $(this).parent().find('input').val();
                        location.href = 'application_details.html?appId=' + appId1;
                    }

                }
            }
        })

    });

</script>

</body>
</html>

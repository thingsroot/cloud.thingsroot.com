<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" href="img/favicon.ico" />
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/viccom.css" rel="stylesheet" />
    <title>信息详情</title>
</head>
<body>


<input id="string" type="hidden" value="">
<input id="json" type="hidden" value="">


<table>
    <thead>
        <tr>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td></td>
        </tr>
    </tbody>
</table>

<script src="js/jquery-1.11.3.min.js"></script>
<script src="js/jQuery.cookie.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.4.0/papaparse.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.4.0/papaparse.min.js"></script>
<script>
    var token = $.cookie('DS_auth_token');
    $.ajaxSetup({
        headers: { // 默认添加请求头
            "X-Frappe-CSRF-Token": token
        }
    });

    (function ($) {
        $.getUrlParam = function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
    })(jQuery);

    var tempId = $.getUrlParam('tempId');
    var appId = $.getUrlParam('appId');
    var version = $.getUrlParam('version');

    //获取模板内容
    var data = {
        app     : appId,
        conf    : tempId,
        version : version
    };

    $.ajax({
        url:"apis/api/method/conf_center.api.app_conf_data",
        type:"GET",
        data: data,
        async: false,
        success: function(data){
            // console.log(data.message.data);
            if( typeof data.message.data){
                console.log('字符串')
                $('#string').val(data.message.data);
                var data = Papa.parse($('#string').val());
                console.log(data);
                var head = data.data[0];
                // for(var i=0;i<head.length;i++){
                //
                // }

            }
        },
        error: function () {
            console.log('error')
        }
    });



    // Papa.parse($('#string').val(), {
    //     download: true,
    //                           //
    //     complete: function(results) {    //csv分析结束要执行的函数，除了complete还可以加before，error等情况的分析函数
    //         console.log(results)
    //     }
    //
    // });


</script>

</body>
</html>